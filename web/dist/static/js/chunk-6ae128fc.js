(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6ae128fc"],{2985:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Card",{staticStyle:{"margin-top":"2%"}},[a("p",{attrs:{slot:"title"},slot:"title"},[t._v("\n        修改文章\n    ")]),a("div",{attrs:{slot:"extra"},slot:"extra"},[a("span",{staticStyle:{"margin-right":"10px"}},[t._v("自动保存")]),a("i-switch",{attrs:{size:"large"},model:{value:t.auto_save,callback:function(e){t.auto_save=e},expression:"auto_save"}},[a("span",{attrs:{slot:"open"},slot:"open"},[t._v("开")]),a("span",{attrs:{slot:"close"},slot:"close"},[t._v("关")])])],1),a("Form",{attrs:{"label-position":"top"}},[a("FormItem",{attrs:{label:"标题"}},[a("Input",{on:{blur:t.save_article},model:{value:t.title,callback:function(e){t.title=e},expression:"title"}})],1),a("FormItem",{attrs:{label:"标签"}},[a("Cascader",{attrs:{data:t.tag_tree,"change-on-select":""},on:{blur:t.save_article},model:{value:t.tag_list,callback:function(e){t.tag_list=e},expression:"tag_list"}})],1),a("FormItem",{attrs:{label:"正文"}},[a("div",{staticStyle:{height:"70vh"}},[a("quill-editor",{staticStyle:{height:"90%"},attrs:{options:t.options},on:{blur:t.save_article},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}})],1)]),a("FormItem",[a("Button",{attrs:{type:"primary"},on:{click:t.add_article}},[t._v("提交")]),a("Button",{staticStyle:{"margin-left":"8px"},attrs:{type:"success"},on:{click:t.save_article_cache}},[t._v("保存")]),a("Button",{staticStyle:{"margin-left":"8px"},attrs:{type:"warning"},on:{click:function(e){return t.load_cloud()}}},[t._v("加载云端存档")]),a("Button",{staticStyle:{"margin-left":"8px"},on:{click:t.cancel_edit}},[t._v("取消")])],1)],1)],1)},n=[],r=(a("7f7f"),a("ac6a"),a("1487")),o=a.n(r),c=(a("6e2e"),a("9339")),l=a("f318"),s=a.n(l),u=a("5dde"),d=a("3b2f");window.katex=d;var g=a("06ea");c["register"](g.TableCell),c["register"](g.TableRow),c["register"](g.Table),c["register"](g.Contain),c["register"]("modules/table",g.TableModule),c["register"]("modules/imageResize",s.a),c["register"]("modules/ImageExtend",u["a"]);for(var h=10,_=5,f=[],p=1;p<=h;p++)for(var b=1;b<=_;b++)f.push("newtable_"+p+"_"+b);var m={name:"change_article",data:function(){return{content:"",cloud:"",title:"",query:"",tag:"",auto_save:!0,request:void 0,db:void 0,tag_tree:[],tag_list:[],options:{modules:{formula:!0,syntax:{highlight:function(t){return o.a.highlightAuto(t).value}},table:!0,markdownShortcuts:{},ImageExtend:{loading:!0,name:"picture",size:3,action:"https://www.wiseweblab.com/api/api/upload/upload_picture",response:function(t){return t.data}},imageResize:{modules:["Resize","DisplaySize","Toolbar"]},toolbar:{container:[["bold","italic","underline","strike"],[{header:[1,2,3,4,!1]},{list:"ordered"},{list:"bullet"}],[{indent:"-1"},{indent:"+1"},{align:[]}],["blockquote","code-block","link","image","formula"],[{color:[]},{background:[]}],[{table:f},{table:"append-row"},{table:"append-col"}],["clean"]],handlers:{image:function(){u["b"].emit(this.quill.id)}}}},placeholder:"请在此输入内容"}}},methods:{add_article:function(){var t=this,e=this,a={title:e.title,content:e.content,tag:this.tag_list[this.tag_list.length-1],token:e.$Cookies.get("token"),article_id:this.query.id};this.$api.article.change_article(a).then(function(e){1===e.data.code&&(t.get_tag_tree(),t.delete_article_cache(),t.$router.back())})},get_tag_tree:function(){var t=this;this.$api.tag.get_tag_tree().then(function(e){if(1===e.data.code){var a=e.data.data;t.tag_tree=t.set_tag_tree(a),t.$store.commit("update_tag",a)}})},set_tag_tree:function(t){var e=this,a=[];return t.forEach(function(t){0===t["type"]&&a.push({value:t["ID"],label:t["name"],children:e.set_tag_tree(t["children"])})}),a},get_tag_list:function(t){var e=this;this.$api.tag.get_tag_list(t).then(function(t){1===t.data.code&&(e.tag_list=t.data.data)})},cancel_edit:function(){this.delete_article_cache(),this.$router.back()},save_article:function(){this.auto_save&&(this.$Notice.info({title:"正在自动保存···"}),this.save_article_cache())},load_article_cache:function(){var t=this.db.transaction("change_article","readwrite").objectStore("change_article").get(this.$route.query.id),e=this;t.onerror=function(t){e.$Notice.warning({title:"读取缓存失败"})},t.onsuccess=function(a){t.result?(e.content=t.result.content,e.title=t.result.title,e.tag=t.result.tag,e.get_tag_list(t.result.tag),e.$Notice.info({title:"已读取缓存"})):console.log("未获得数据记录")}},save_article_cache:function(){var t=this.db.transaction("change_article","readwrite").objectStore("change_article").add({id:this.$route.query.id,content:this.content,title:this.title,tag:this.tag_list[this.tag_list.length-1]}),e=(this.db.transaction("change_article","readwrite").objectStore("change_article").put({id:this.$route.query.id,content:this.content,title:this.title,tag:this.tag_list[this.tag_list.length-1]}),this);t.onsuccess=function(t){e.$Notice.warning({title:"本地保存失败,请重试(第一次保存可能出现失败情况)"})},t.onerror=function(t){e.$Notice.success({title:"本地保存成功"})}},delete_article_cache:function(){var t=this.db.transaction(["change_article"],"readwrite").objectStore("change_article").delete(this.$route.query.id),e=this;t.onsuccess=function(t){e.$Notice.info({title:"本地缓存已释放"})},t.onerror=function(t){e.$Notice.warning({title:"本地缓存释放失败"})}},load_cloud:function(){var t=this;this.query=this.$route.query,this.$api.article.get_article(this.$route.query.id).then(function(e){1===e.data.code&&(t.content=e.data.data.content,t.title=e.data.data.title,t.tag=e.data.data.tag,t.get_tag_list(t.tag),t.get_tag_tree())})}},mounted:function(){var t=this;this.query=this.$route.query,this.$api.article.get_article(this.$route.query.id).then(function(e){if(1===e.data.code){t.content=e.data.data.content,t.title=e.data.data.title,t.tag=e.data.data.tag,t.get_tag_list(t.tag),t.get_tag_tree(),t.request=window.indexedDB.open("article_cache"),t.request.onerror=function(t){this.$Notice.warning({title:"本地数据库打开失败",desc:"本地数据库打开失败，文章将不会自动缓存！"})};var a=t;t.request.onsuccess=function(t){a.db=t.target.result,a.load_article_cache()},t.request.onupgradeneeded=function(t){var e;a.db=t.target.result,a.db.objectStoreNames.contains("article")||(e=a.db.createObjectStore("article",{keyPath:"id",autoIncrement:!0}),e.createIndex("content","content",{unique:!0}),e.createIndex("title","title",{unique:!0})),a.db.objectStoreNames.contains("change_article")||(e=a.db.createObjectStore("change_article",{keyPath:"id",autoIncrement:!0}),e.createIndex("content","content",{unique:!0}),e.createIndex("title","title",{unique:!0}),e.createIndex("tag","tag",{unique:!0}))}}else t.$router.push({name:"login"})})}},v=m,S=(a("f568"),a("2877")),y=Object(S["a"])(v,i,n,!1,null,"a348b408",null);e["default"]=y.exports},"7f7f":function(t,e,a){var i=a("86cc").f,n=Function.prototype,r=/^\s*function ([^ (]*)/,o="name";o in n||a("9e1e")&&i(n,o,{configurable:!0,get:function(){try{return(""+this).match(r)[1]}catch(t){return""}}})},"9c05":function(t,e,a){},ac6a:function(t,e,a){for(var i=a("cadf"),n=a("0d58"),r=a("2aba"),o=a("7726"),c=a("32e9"),l=a("84f2"),s=a("2b4c"),u=s("iterator"),d=s("toStringTag"),g=l.Array,h={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},_=n(h),f=0;f<_.length;f++){var p,b=_[f],m=h[b],v=o[b],S=v&&v.prototype;if(S&&(S[u]||c(S,u,g),S[d]||c(S,d,b),l[b]=g,m))for(p in i)S[p]||r(S,p,i[p],!0)}},f568:function(t,e,a){"use strict";var i=a("9c05"),n=a.n(i);n.a}}]);